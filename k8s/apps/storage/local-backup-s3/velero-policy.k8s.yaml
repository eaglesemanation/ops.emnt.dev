# yaml-language-server: $schema=https://raw.githubusercontent.com/eaglesemanation/CRDs-catalog/minio/sts.min.io/policybinding_v1alpha1.json
apiVersion: sts.min.io/v1alpha1
kind: PolicyBinding
metadata:
  name: velero
  namespace: local-backup-s3
spec:
  application:
    namespace: velero
    serviceaccount: velero-sa
  policies:
    - velero-rw
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: velero-policy
  namespace: local-backup-s3
data:
  policy.json: |-
    {
      "Version": "2012-10-17",
      "Statement":
        [
          {
            "Effect": "Allow",
            "Action":
              [
                "ec2:DescribeVolumes",
                "ec2:DescribeSnapshots",
                "ec2:CreateTags",
                "ec2:CreateVolume",
                "ec2:CreateSnapshot",
                "ec2:DeleteSnapshot",
              ],
            "Resource": "*",
          },
          {
            "Effect": "Allow",
            "Action":
              [
                "s3:GetObject",
                "s3:DeleteObject",
                "s3:PutObject",
                "s3:AbortMultipartUpload",
                "s3:ListMultipartUploadParts",
              ],
            "Resource": ["arn:aws:s3:::velero/*"],
          },
          {
            "Effect": "Allow",
            "Action": ["s3:ListBucket"],
            "Resource": ["arn:aws:s3:::velero"],
          },
        ],
    }
