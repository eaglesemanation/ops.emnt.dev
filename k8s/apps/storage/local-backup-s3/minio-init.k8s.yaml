apiVersion: v1
kind: ServiceAccount
metadata:
  name: mc-job-sa
  namespace: local-backup-s3
---
# yaml-language-server: $schema=https://raw.githubusercontent.com/eaglesemanation/CRDs-catalog/minio/sts.min.io/policybinding_v1alpha1.json
apiVersion: sts.min.io/v1alpha1
kind: PolicyBinding
metadata:
  name: mc-job-binding
  namespace: local-backup-s3
spec:
  application:
    serviceaccount: mc-job-sa
    namespace: local-backup-s3
  policies:
    - consoleAdmin
---
# yaml-language-server: $schema=https://raw.githubusercontent.com/eaglesemanation/CRDs-catalog/minio/job.min.io/miniojob_v1alpha1.json
apiVersion: job.min.io/v1alpha1
kind: MinIOJob
metadata:
  name: minio-init-job
  namespace: minio-operator
spec:
  serviceAccountName: mc-job-sa
  tenant:
    name: minio
    namespace: local-backup-s3
  commands:
    - name: velero-policy
      op: admin/policy/create
      args:
        name: velero-rw
        policy: /temp/policy.json
      volumeMounts:
        - name: policy
          mountPath: /temp
      volumes:
        - name: policy
          configMap:
            name: velero-policy
